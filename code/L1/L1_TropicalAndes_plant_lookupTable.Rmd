---
title: "Tropical Andes plant Lookup Table"
author: "Hazel J. Anderson"
project: "Plant-Frugivore Diversity"
collaborators: "Beth E. Gerstner, Phoebe L. Zarnetske"
overview: ""
data input: ""
data output: ""
date: "2023-07-25"
output: html_document
---

# Set file paths
```{r}
data_path <- file.path('G:/Shared drives/SpaCE_Lab_FRUGIVORIA/data/plants/L0')
output_path <- file.path('G:/Shared drives/SpaCE_Lab_FRUGIVORIA/data/plants/L1')
```

# Load required packages
```{r}
library(taxize)
library(knitr)
library(TNRS)
```

# Read in species lists
```{r}
TRY_species <- read.csv(file.path(data_path,"TropicalAndes_TRY_plant_species.csv"))
BIEN_species <- read.csv(file.path(data_path,"TropicalAndes_BIEN_plant_trait_species.csv"))
GBIF_species <- read.csv(file.path(data_path,"TropicalAndes_GBIF_plant_species.csv"))
```

```{r}
# convert species list to character
TRY_species_chr <- as.character(TRY_species$x)
BIEN_species_chr <- as.character(BIEN_species$x)
GBIF_species_chr <- as.character(GBIF_species$x)
```


# Using TNRS
```{r}
BIEN_results <- TNRS(taxonomic_names = BIEN_species)
```

```{r}
TRY_results <- TNRS(taxonomic_names = TRY_species)
```

```{r}
#split up gbif species list to speed up api call
GBIF_species1 <-GBIF_species[1:33107,]
GBIF_species2 <-GBIF_species[33107:66214,]
GBIF_species3 <-GBIF_species[66214:99321,]
GBIF_species4 <-GBIF_species[99321:132428,]

GBIF_results1 <- TNRS(taxonomic_names = GBIF_species1)
GBIF_results2 <- TNRS(taxonomic_names = GBIF_species2)
GBIF_results3 <- TNRS(taxonomic_names = GBIF_species3)
GBIF_results4 <- TNRS(taxonomic_names = GBIF_species4)
```

```{r}
#combine gbif results
GBIF_results <- rbind(GBIF_results1, GBIF_results2, GBIF_results3, GBIF_results4)
```

```{r}
#save full results
write.csv(BIEN_results, file.path(output_path,"BIEN_plant_species_resolved_output_full.csv"))
write.csv(TRY_results, file.path(output_path,"TRY_plant_species_resolved_output_full.csv"))
write.csv(GBIF_results, file.path(output_path,"GBIF_plant_species_resolved_output_full.csv"))
```

```{r}
# subset results to rows with Name_submitted values not the same as Accepted_name

```


# Using taxsize
```{r}
GBIF_species_resolved <- resolve(GBIF_species)
TRY_species_resolved <- resolve(TRY_species)
BIEN_species_resolved <- resolve(BIEN_species)
```

